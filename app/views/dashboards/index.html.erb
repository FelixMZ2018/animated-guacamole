<style>
.weather_image{
    width: 60%;
    justify-content: center;
}
.cloud{
    visibility: hidden;
    transition-duration: 1s;
}

</style>
<br>
<br>

<div class = "swiper-box text-center p-3">
<p class="time"></p>

<p class="temperature"></p>

<p class="condition"></p>
<br>
<%= image_tag  "cloud.png",:class => "weather_image cloud" %>

</div>

  <div class="icon-bar pb-3">
    <a href="/preferences"><i class="fas fa-sliders-h right"></i></a>
    <a href="/forecast"><i class="fas fa-chevron-down"></i></a>
  </div>

<script>

var index = 0
var forecast = <%= JSON.generate(@forecast_hourly).html_safe%>
console.log(forecast[index])
update()


function myFunction() {
    if (index + 1 < forecast.length) {
            index = index + 1
    console.log(forecast[index])
    update()
    }

}

function update(){
    document.querySelector('.temperature').innerText = `${Math.round(forecast[index].temp)}Â°C`;
    document.querySelector('.time').innerText = new Date(forecast[index].dt*1000)
    document.querySelector('.condition').innerText = forecast[index].weather[0].main
    update_clouds()

}
function update_clouds(){
 if (forecast[index].weather[0].main == "Clouds") {
    document.querySelector('.cloud').style.visibility = "visible"
 } else {
    document.querySelector('.cloud').style.visibility = "hidden"

 }
}
document.addEventListener("touchstart", startTouch, false);
document.addEventListener("touchmove", moveTouch, false);

// Swipe Up / Down / Left / Right
var initialX = null;
var initialY = null;

function startTouch(e) {
  initialX = e.touches[0].clientX;
  initialY = e.touches[0].clientY;
};

function moveTouch(e) {
  if (initialX === null) {
    return;
  }

  if (initialY === null) {
    return;
  }

  var currentX = e.touches[0].clientX;
  var currentY = e.touches[0].clientY;

  var diffX = initialX - currentX;
  var diffY = initialY - currentY;

  if (Math.abs(diffX) > Math.abs(diffY)) {
    // sliding horizontally
    if (diffX > 0) {
      // swiped left
      console.log("swiped left");
          if (index + 1 < forecast.length) {
            index = index + 1
    console.log(forecast[index])
    update()
    }

    } else {
      // swiped right
      console.log("swiped right");
          if (index > 1) {
            index = index - 1
    console.log(forecast[index])
    update()
    }
    }
  } else {
    // sliding vertically
    if (diffY > 0) {
      // swiped up
      console.log("swiped up");
    } else {
      // swiped down
      console.log("swiped down");
    }
  }

  initialX = null;
  initialY = null;

  e.preventDefault();
};

</script>
